---
image: nixos/unstable
secrets:
  - 11097f83-8e5a-46c9-be7f-d4c746730000 # ~/.ssh/config
  - 11affa26-7640-4dea-8233-045ddd667367 # ~/.ssh/id_rsa
  - 47005b27-ef6a-42c2-a1f3-3424cf1e0098 # ~/.config/cachix/cachix.dhall
  - a4fc2b74-cbd2-4f32-ba60-8e35a4dec141 # README access token
packages:
  - nixos.cachix
  - nixos.nixUnstable
  - nixos.nix-output-monitor
environment:
  NIX: cachix watch-exec cfeeley nix --
  NIX_CONFIG: |
    experimental-features = nix-command flakes
    accept-flake-config = true
    keep-going = true
    allow-import-from-derivation = true
tasks:
  - show: |
      cd dotfield
      $NIX --print-build-logs flake show
  - devshell: |
      cd dotfield
      $NIX --print-build-logs build .#devShell.x86_64-linux
  - readme: |
      cd dotfield
      echo "Updating README"
      $NIX --print-build-logs develop .#devShell.x86_64-linux -c dotfield-docs
      echo "Updated README"
  - check: |
      cd dotfield
      $NIX --print-build-logs flake check
