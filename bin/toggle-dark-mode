#!/usr/bin/env zsh
#
# Toggle system dark mode and run various related effects.
#

emulate -L zsh
setopt extended_glob warn_create_global typeset_silent \
  no_short_loops rc_quotes no_auto_pushd

.kitty-theme-change () {
  #@TODO use realpath?
  local dots_config_dir="$DOTS/kitty/.config/kitty"
  local theme_path="$dots_config_dir/base16-kitty/colors/base16-$1-256.conf"
  ln -sfv "$theme_path" "$dots_config_dir/theme.conf"
  kitty @ --to unix:/tmp/kitty-socket \
    set-colors -a -c "$dots_config_dir/theme.conf"
}

.emacs-theme-change () {
  emacsclient --no-wait --eval "(+cdom/load-os-theme)"
}

local THEME
dark-mode && THEME=$(cdom_base16_theme $(cdom_os_appearance)) && () {
    .kitty-theme-change $THEME
    # @TODO set base16-shell and base16-fzf colors on demand
    # base16-set-theme $THEME
    .emacs-theme-change $THEME
  }
